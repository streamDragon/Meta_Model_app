<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meta Model - כלי תרגול שאול מטה מודל</title>
    <link rel="stylesheet" href="css/style.css?v=1.0.3">
</head>
<body>
    <!-- SPLASH SCREEN -->
    <div id="splash-screen" class="splash-screen">
        <div class="splash-content">
            <div class="splash-logo">🧠</div>
            <h1 class="splash-title">Meta Model</h1>
            <p class="splash-subtitle">כלי תרגול שאול מטה מודל</p>
            <div class="splash-loading">
                <span class="splash-dot"></span>
                <span class="splash-dot"></span>
                <span class="splash-dot"></span>
            </div>
        </div>
    </div>

    <div id="app-version-floating" class="app-version-floating" aria-live="polite">v...</div>
    <div class="container">
        <header>
            <h1>🧠 Meta Model - כלי תרגול</h1>
            <p>תרגל שאול מטה מודל של Richard Bandler על פי הכללים של NLP</p>
            <div class="onboarding-hint" id="hint-box" style="display:none">
                <small id="hint-text"></small>
                <button onclick="closeHint()" class="close-hint">✕</button>
            </div>
        </header>

        <nav class="tabs">
            <button class="tab-btn active" data-tab="home">בית</button>
            <button class="tab-btn" data-tab="scenario-trainer">סצנות Execution</button>
            <button class="tab-btn" data-tab="comic-engine">Comic Engine</button>
            <button class="tab-btn" data-tab="categories">קטגוריות</button>
            <button class="tab-btn" data-tab="practice">תרגול</button>
            <button class="tab-btn" data-tab="blueprint">Blueprint Builder</button>
            <button class="tab-btn" data-tab="prismlab">מעבדת פריזמות</button>
            <button class="tab-btn" data-tab="about">על הפרויקט</button>
        </nav>
        <div class="mobile-tab-nav" aria-label="ניווט בנייד">
            <label for="mobile-tab-select">מעבר למסך</label>
            <select id="mobile-tab-select" class="mobile-tab-select" aria-label="מעבר בין מסכים"></select>
        </div>

        <section id="global-comic-strip" class="global-comic-strip hidden" aria-label="Comic strip preview">
            <div class="global-comic-strip-inner">
                <article class="global-comic-main">
                    <img id="global-comic-main-img" src="" alt="" loading="lazy">
                    <div class="global-comic-main-meta">
                        <div>
                            <p class="global-comic-eyebrow">Comic Layer</p>
                            <h3 id="global-comic-main-title">Scene</h3>
                            <p id="global-comic-main-subtitle"></p>
                        </div>
                        <div class="global-comic-main-actions">
                            <button id="global-comic-main-preview" class="global-comic-main-link" type="button">תצוגה</button>
                            <button id="global-comic-main-practice" class="global-comic-main-link global-comic-main-link-primary" type="button">לתרגול</button>
                        </div>
                    </div>
                </article>
                <div id="global-comic-thumbs" class="global-comic-thumbs" role="list"></div>
            </div>
        </section>

        <div id="comicPreviewModal" class="comic-preview-modal hidden" role="dialog" aria-modal="true" aria-labelledby="comicPreviewTitle">
            <div class="comic-preview-dialog">
                <button id="comicPreviewClose" class="comic-preview-close" type="button" aria-label="סגירה">✕</button>
                <h3 id="comicPreviewTitle">תצוגת קומיקס</h3>
                <img id="comicPreviewImage" src="" alt="" loading="lazy">
                <p id="comicPreviewSubtitle"></p>
                <div class="comic-preview-actions">
                    <button id="comicPreviewGoPractice" class="btn btn-primary" type="button">מעבר לתרגול בסצנה</button>
                </div>
            </div>
        </div>

        <!-- HOME TAB -->
        <section id="home" class="tab-content active">
            <div class="card">
                <h2>ברוכים הבאים! 👋</h2>
                <p id="app-version-chip" class="app-version-chip">גרסה: נטען...</p>
                <p>Meta Model היא טכניקה ב-NLP המסייעת לזיהוי ותיקון הפרות שפה שמגבילות אותנו.</p>
                
                <div class="intro-grid">
                    <div class="intro-item">
                        <h3>🎯 מה זה Meta Model?</h3>
                        <p>מודל שפה המזהה 3 עיוותים: מחיקה, עיוות והכללה.</p>
                    </div>
                    <div class="intro-item">
                        <h3>📚 למה זה חשוב?</h3>
                        <p>זוהי כלי חזקה לתרגול עומק, כדי להבין ולשנות דפוסים של חשיבה.</p>
                    </div>
                    <div class="intro-item">
                        <h3>✨ כיצד להשתמש?</h3>
                        <p>בחר קטגוריה ללמוד או עבור לתרגול כדי להתאמן בשאול שאלות.</p>
                    </div>
                </div>

                <div class="cta-section">
                    <h3>🚀 בואן נתחיל!</h3>
                    <p>בחר מה ברצונך לעשות:</p>
                    <div class="cta-buttons">
                        <button class="btn btn-primary cta-btn" onclick="navigateTo('scenario-trainer')">🎬 סצנות Execution</button>
                        <button class="btn btn-primary cta-btn" onclick="navigateTo('comic-engine')">🧩 Comic Engine 2.0</button>
                        <button class="btn btn-secondary cta-btn" onclick="window.open('assets/svg/demo/index.html', '_blank')">🎨 Comic Kit Demo</button>
                        <button class="btn btn-primary cta-btn" onclick="navigateTo('categories')">📚 לומד קטגוריות</button>
                        <button class="btn btn-primary cta-btn" onclick="navigateTo('blueprint')">🏗️ בנה Blueprint</button>
                        <button class="btn btn-primary cta-btn" onclick="navigateTo('prismlab')">🔍 סרוק פריזמות</button>
                        <button class="btn btn-secondary cta-btn" onclick="navigateTo('practice')">🎮 תרגול חופשי</button>
                    </div>
                </div>

                <!-- PROGRESS HUB -->
                <div class="progress-hub">
                    <h3>📊 ההתקדמות שלך</h3>
                    <div class="progress-grid">
                        <div class="progress-card">
                            <span class="progress-icon">🔥</span>
                            <p class="progress-label">Streak</p>
                            <p class="progress-value" id="streak-count">0 ימים</p>
                            <small id="streak-date">היום הראשון!</small>
                        </div>
                        <div class="progress-card">
                            <span class="progress-icon">⭐</span>
                            <p class="progress-label">XP Total</p>
                            <p class="progress-value" id="xp-count">0</p>
                            <small>כל משימה = נקודות</small>
                        </div>
                        <div class="progress-card">
                            <span class="progress-icon">🌟</span>
                            <p class="progress-label">Stars</p>
                            <p class="progress-value" id="stars-count">0</p>
                            <small>בונוס מכל תשובה</small>
                        </div>
                        <div class="progress-card">
                            <span class="progress-icon">🏆</span>
                            <p class="progress-label">Badges</p>
                            <p class="progress-value" id="badge-count">0</p>
                            <small>פרסים שהצברת</small>
                        </div>
                        <div class="progress-card">
                            <span class="progress-icon">📈</span>
                            <p class="progress-label">Sessions</p>
                            <p class="progress-value" id="session-count">0</p>
                            <small>סשנים שהשלמת</small>
                        </div>
                        <div class="progress-card" id="daily-goal-card">
                            <span class="progress-icon">🎯</span>
                            <p class="progress-label">Daily Goal</p>
                            <p class="progress-value" id="daily-goal-value">0/3</p>
                            <div class="daily-goal-meter" aria-hidden="true">
                                <div class="daily-goal-fill" id="daily-goal-fill"></div>
                            </div>
                            <small id="daily-goal-note">השלם 3 פעולות היום</small>
                        </div>
                        <div class="progress-card">
                            <span class="progress-icon">🛡️</span>
                            <p class="progress-label">Streak Charge</p>
                            <p class="progress-value" id="streak-charge-value">0/3</p>
                            <small id="streak-charge-note">שומר על רצף ביום פספוס</small>
                        </div>
                    </div>
                    <div id="badges-display" class="badges-display">
                        <!-- Badges will render here -->
                    </div>
                </div>
            </div>
        </section>

        <!-- SCENARIO TRAINER TAB -->
        <section id="scenario-trainer" class="tab-content">
            <div class="scenario-trainer-container">
                <div class="card scenario-trainer-card">
                    <h2>🎬 Scenario Trainer: פועל לא-מפורש → ביצוע</h2>
                    <p class="subtitle">תרגול קצר מסצנה לחיים אמיתיים: פחות האשמה, יותר פירוק לתהליך.</p>

                    <div id="scenario-safety-notice" class="scenario-safety-notice hidden" role="alert">
                        נראה שהטקסט שכתבת מצביע על מצוקה חריפה. עצרנו את התרגול כרגע.
                        אם יש סכנה מיידית: 911. אפשר גם לפנות לקו 988 (24/7).
                    </div>

                    <!-- HOME -->
                    <div id="scenario-screen-home" class="scenario-screen">
                        <div class="scenario-home-grid">
                            <button id="scenario-home-scenes" class="btn btn-primary scenario-home-btn">🎬 סצנות</button>
                            <button id="scenario-home-prisms" class="btn btn-secondary scenario-home-btn">🧩 פריזמות (Drag&Drop)</button>
                            <button id="scenario-home-history" class="btn btn-secondary scenario-home-btn">🕘 היסטוריה</button>
                            <button id="scenario-home-settings" class="btn btn-secondary scenario-home-btn">⚙️ הגדרות</button>
                        </div>
                        <div class="scenario-home-stats" id="scenario-home-stats"></div>
                    </div>

                    <!-- DOMAIN PICK -->
                    <div id="scenario-screen-domain" class="scenario-screen hidden">
                        <h3>בחירת תחום ורמה</h3>
                        <div class="blueprint-questions scenario-pick-grid">
                            <div class="q-card">
                                <label for="scenario-domain-select">תחום</label>
                                <select id="scenario-domain-select"></select>
                            </div>
                            <div class="q-card">
                                <label for="scenario-difficulty-select">רמה</label>
                                <select id="scenario-difficulty-select"></select>
                            </div>
                            <div class="q-card">
                                <label for="scenario-run-size">כמה סצנות ברצף?</label>
                                <input type="range" id="scenario-run-size" min="5" max="10" value="10" />
                                <span id="scenario-run-size-value">10</span>
                            </div>
                        </div>
                        <div class="step-buttons">
                            <button id="scenario-start-run-btn" class="btn btn-primary">התחל סשן סצנות</button>
                            <button id="scenario-back-home-from-domain" class="btn btn-secondary">חזרה</button>
                        </div>
                    </div>

                    <!-- SCENARIO -->
                    <div id="scenario-screen-play" class="scenario-screen hidden">
                        <div class="scenario-session-header">
                            <p class="scenario-counter">סצנה <span id="scenario-current-index">1</span>/<span id="scenario-total-count">10</span></p>
                            <p class="scenario-session-meta">נקודות: <span id="scenario-session-score">0</span> | רצף ירוק: <span id="scenario-session-streak">0</span></p>
                        </div>
                        <div class="progress-bar">
                            <div id="scenario-progress-fill" class="progress-fill"></div>
                        </div>
                        <div class="scenario-story-card">
                            <div class="scenario-role" id="scenario-role"></div>
                            <h3 id="scenario-title"></h3>
                            <div id="scenario-story-lines" class="scenario-story-lines"></div>
                            <p class="scenario-unspecified-line">המשפט הלא-מפורש: <strong id="scenario-unspecified-verb"></strong></p>
                        </div>
                        <div id="scenario-comic-stage" class="scenario-comic-stage" hidden>
                            <div class="scenario-comic-image-wrap">
                                <img id="scenario-comic-image" src="" alt="" loading="lazy">
                            </div>
                            <div class="scenario-comic-caption">
                                <p class="scenario-comic-label">Comic Scene</p>
                                <h4 id="scenario-comic-title"></h4>
                                <p id="scenario-comic-subtitle"></p>
                            </div>
                        </div>
                        <div id="scenario-options-container" class="scenario-options-container"></div>
                    </div>

                    <!-- FEEDBACK -->
                    <div id="scenario-screen-feedback" class="scenario-screen hidden">
                        <div id="scenario-feedback-mark" class="scenario-feedback-mark"></div>
                        <h3 id="scenario-feedback-title"></h3>
                        <p id="scenario-feedback-text"></p>
                        <div id="scenario-consequence-box" class="scenario-consequence-box hidden">
                            <h4 id="scenario-consequence-title"></h4>
                            <p id="scenario-consequence-action"></p>
                            <p id="scenario-consequence-result"></p>
                        </div>
                        <button id="scenario-show-blueprint-btn" class="btn btn-primary">הראה את הפירוק</button>
                    </div>

                    <!-- BLUEPRINT -->
                    <div id="scenario-screen-blueprint" class="scenario-screen hidden">
                        <h3>Blueprint קומפקטי</h3>
                        <div class="final-blueprint-display scenario-blueprint-display">
                            <div class="blueprint-section">
                                <h4>🎯 מטרה</h4>
                                <p id="scenario-blueprint-goal"></p>
                            </div>
                            <div class="blueprint-section">
                                <h4>⏱️ צעד ראשון (10 דקות)</h4>
                                <p id="scenario-blueprint-first-step"></p>
                            </div>
                            <div class="blueprint-section">
                                <h4>🧭 שלבים</h4>
                                <ul id="scenario-blueprint-steps"></ul>
                            </div>
                            <div class="blueprint-section">
                                <h4>🧱 נקודת תקיעה</h4>
                                <p id="scenario-blueprint-stuck"></p>
                            </div>
                            <div class="blueprint-section">
                                <h4>🛟 Plan B / תחליף</h4>
                                <p id="scenario-blueprint-planb"></p>
                            </div>
                            <div class="blueprint-section">
                                <h4>✅ מדד הצלחה (Done)</h4>
                                <p id="scenario-blueprint-done"></p>
                            </div>
                        </div>

                        <div class="scenario-green-box">
                            <h4>המשפט הירוק המוצע</h4>
                            <p id="scenario-green-sentence"></p>
                            <button id="scenario-copy-green-btn" class="btn btn-secondary">העתק משפט ירוק</button>
                        </div>

                        <div id="scenario-prism-wheel" class="scenario-prism-wheel hidden">
                            <h4>גלגל פריזמות מהיר (אופציונלי)</h4>
                            <div id="scenario-prism-items" class="scenario-prism-items"></div>
                            <div id="scenario-prism-detail" class="scenario-prism-detail hidden"></div>
                        </div>

                        <div class="q-card">
                            <label for="scenario-user-note">הערה אישית (רשות): מה תגיד/י בפעם הבאה?</label>
                            <textarea id="scenario-user-note" rows="3" placeholder="כתוב/י ניסוח קצר או תובנה..."></textarea>
                        </div>

                        <div class="step-buttons">
                            <button id="scenario-finish-scene-btn" class="btn btn-primary">סיום סצנה</button>
                        </div>
                    </div>

                    <!-- SCORE -->
                    <div id="scenario-screen-score" class="scenario-screen hidden">
                        <div id="scenario-stars-row" class="scenario-stars-row"></div>
                        <p id="scenario-score-line" class="scenario-score-line"></p>
                        <p id="scenario-next-green-line" class="scenario-next-green-line"></p>
                        <div id="scenario-result-summary" class="scenario-result-summary hidden">
                            <p><strong>מטרה כללית:</strong> <span id="scenario-result-goal"></span></p>
                            <p><strong>מדד הצלחה:</strong> <span id="scenario-result-metric"></span></p>
                        </div>
                        <div class="step-buttons">
                            <button id="scenario-next-scene-btn" class="btn btn-primary">המשך לסצנה הבאה</button>
                            <button id="scenario-back-home-btn" class="btn btn-secondary">חזרה לבית הסצנות</button>
                        </div>
                    </div>

                    <!-- HISTORY -->
                    <div id="scenario-screen-history" class="scenario-screen hidden">
                        <h3>היסטוריית סצנות</h3>
                        <div class="step-buttons">
                            <button id="scenario-export-history-btn" class="btn btn-secondary">ייצא JSON</button>
                            <button id="scenario-clear-history-btn" class="btn btn-secondary">נקה היסטוריה</button>
                            <button id="scenario-back-home-from-history" class="btn btn-primary">חזרה</button>
                        </div>
                        <div id="scenario-history-list" class="scenario-history-list"></div>
                    </div>

                    <!-- SETTINGS -->
                    <div id="scenario-screen-settings" class="scenario-screen hidden">
                        <h3>הגדרות סצנות</h3>
                        <div class="blueprint-questions">
                            <div class="q-card">
                                <label for="scenario-setting-domain">תחום ברירת מחדל</label>
                                <select id="scenario-setting-domain"></select>
                            </div>
                            <div class="q-card">
                                <label for="scenario-setting-difficulty">רמת ברירת מחדל</label>
                                <select id="scenario-setting-difficulty"></select>
                            </div>
                            <div class="q-card scenario-toggle-row">
                                <label>
                                    <input type="checkbox" id="scenario-setting-sound" checked />
                                    צלילים במסך הסצנות
                                </label>
                                <label>
                                    <input type="checkbox" id="scenario-setting-prism" checked />
                                    גלגל פריזמות אחרי תשובה ירוקה
                                </label>
                            </div>
                        </div>
                        <div class="step-buttons">
                            <button id="scenario-save-settings-btn" class="btn btn-primary">שמור הגדרות</button>
                            <button id="scenario-back-home-from-settings" class="btn btn-secondary">חזרה</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- COMIC ENGINE TAB -->
        <section id="comic-engine" class="tab-content">
            <div class="card comic-engine-shell">
                <h2>🎭 Comic Engine Flow</h2>
                <p class="subtitle">דיאלוג חי בעמוד אחד: בחירה → תגובת צד שני → תגובה שלך → פרשנות → חלופה שכלית + ויסות סטייט.</p>

                <section id="comicEngine" class="ceflow-engine" dir="rtl">
                    <div class="ceflow-top-actions">
                        <button id="ceflow-info-btn" class="btn btn-secondary ceflow-small-btn" type="button">💡 למה זה עובד?</button>
                    </div>
                    <div id="ceflow-floating-note" class="ceflow-floating-note hidden" aria-live="polite"></div>

                    <header class="ceflow-header">
                        <div class="ceflow-chip-row">
                            <span id="ceflow-domain" class="ceflow-chip">תחום</span>
                            <span id="ceflow-progress" class="ceflow-chip">1/1</span>
                            <span id="ceflow-level" class="ceflow-chip">רמה</span>
                        </div>
                        <h3 id="ceflow-title" class="ceflow-title">כותרת סצנה</h3>
                    </header>

                    <div class="ceflow-stage-wrap">
                        <article id="ceflow-left-character" class="ceflow-character-card"></article>

                        <section class="ceflow-stage" aria-live="polite">
                            <div id="ceflow-dialog" class="ceflow-dialog"></div>

                            <div id="ceflow-overlay" class="ceflow-overlay hidden">
                                <div id="ceflow-xray-tags" class="ceflow-xray-tags"></div>
                                <div class="ceflow-stats">
                                    <div class="ceflow-stat">
                                        <span>Flow</span>
                                        <div class="ceflow-bar"><span id="ceflow-stat-flow"></span></div>
                                    </div>
                                    <div class="ceflow-stat">
                                        <span>Agency</span>
                                        <div class="ceflow-bar"><span id="ceflow-stat-agency"></span></div>
                                    </div>
                                    <div class="ceflow-stat">
                                        <span>Shame</span>
                                        <div class="ceflow-bar"><span id="ceflow-stat-shame"></span></div>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <article id="ceflow-right-character" class="ceflow-character-card"></article>
                    </div>

                    <section>
                        <h4 class="ceflow-block-title">בחר/י תגובה</h4>
                        <div id="ceflow-choice-deck" class="ceflow-choice-deck" role="group" aria-label="אפשרויות תגובה"></div>
                    </section>

                    <section id="ceflow-reply-box" class="ceflow-reply-box hidden">
                        <h4 class="ceflow-block-title">הצד השני הגיב. איך את/ה עונה עכשיו?</h4>
                        <div id="ceflow-reply-quick" class="ceflow-reply-quick"></div>
                        <label for="ceflow-reply-input" class="ceflow-input-label">תגובה שלך:</label>
                        <textarea id="ceflow-reply-input" rows="2" placeholder="כתבו תגובה אחת מדויקת וקצרה..."></textarea>
                        <div class="ceflow-inline-actions">
                            <button id="ceflow-reply-confirm" class="btn btn-primary" type="button">אשר תגובה</button>
                            <small id="ceflow-reply-status" aria-live="polite"></small>
                        </div>
                    </section>

                    <section id="ceflow-feedback" class="ceflow-feedback hidden" aria-live="polite">
                        <div id="ceflow-feedback-left" class="ceflow-feedback-left"></div>
                        <div id="ceflow-feedback-right" class="ceflow-feedback-right"></div>
                    </section>

                    <section id="ceflow-power-card" class="ceflow-power-card hidden">
                        <h4>Power Card: במקום תגובה אימפולסיבית</h4>
                        <p>בחר/י שאלה מטה-מודל אחת. אחרי שאלה מדויקת, הדיאלוג נפתח מחדש.</p>
                        <div id="ceflow-power-questions" class="ceflow-power-questions"></div>
                        <div id="ceflow-new-info" class="ceflow-new-info hidden"></div>
                        <div class="ceflow-inline-actions">
                            <button id="ceflow-open-blueprint-inner" class="btn btn-secondary" type="button">בוא נבנה תוכנית</button>
                        </div>
                    </section>

                    <section id="ceflow-blueprint" class="ceflow-blueprint hidden"></section>

                    <footer class="ceflow-controls">
                        <button id="ceflow-retry" class="btn btn-secondary" type="button" disabled>↻ נסה שוב</button>
                        <button id="ceflow-toggle-mode" class="btn btn-secondary" type="button">📚 מצב לימוד</button>
                        <button id="ceflow-open-blueprint" class="btn btn-secondary hidden" type="button">🧭 בוא נבנה תוכנית</button>
                        <button id="ceflow-next-scene" class="btn btn-primary" type="button" disabled>➡ סצנה הבאה</button>
                    </footer>
                </section>
            </div>
        </section>

        <!-- PRISM LAB TAB -->
        <section id="prismlab" class="tab-content">
            <div class="prism-container">
                <div class="card">
                    <h2>🔍 מעבדת פריזמות (Prism Lab)</h2>
                    <p>בחר פריזמה לסריקה, הוצב שאלת עוגן אחת, ומפה את התשובות על רמות לוגיות.</p>

                    <div class="prism-grid" id="prism-library">
                        <!-- Prism cards will be rendered here -->
                    </div>

                    <div id="prism-detail" class="prism-detail hidden">
                        <h3 id="prism-name"></h3>
                        <p id="prism-desc"></p>
                        <div class="anchor-box">
                            <strong>שאלת העוגן:</strong>
                            <p id="prism-anchor" class="anchor-question"></p>
                        </div>
                        <div id="prism-deep-guide" class="prism-deep-guide"></div>

                        <div class="mapping-form">
                            <div class="prism-tools-row">
                                <button class="btn btn-secondary audio-mute-btn">סאונד פעיל</button>
                            </div>
                            <p class="muted">מלא תשובות למפה לפי רמות (E,B,C,V,I,S)</p>
                            <div class="mapping-row">
                                <div class="prepared-items">
                                    <h4>רשומות מוכנות</h4>
                                    <p class="muted">גרור אל התיבה או לחץ להעתקה</p>
                                    <div id="prepared-list" class="prepared-list"></div>
                                </div>

                                <div class="level-grid">
                                    <div class="level-item"><label>Environment (E)</label><input id="ans-E" class="mapping-input" /></div>
                                    <div class="level-item"><label>Behavior (B)</label><input id="ans-B" class="mapping-input" /></div>
                                    <div class="level-item"><label>Capabilities (C)</label><input id="ans-C" class="mapping-input" /></div>
                                    <div class="level-item"><label>Values/Beliefs (V)</label><input id="ans-V" class="mapping-input" /></div>
                                    <div class="level-item"><label>Identity (I)</label><input id="ans-I" class="mapping-input" /></div>
                                    <div class="level-item"><label>Belonging (S)</label><input id="ans-S" class="mapping-input" /></div>
                                </div>
                            </div>

                            <div class="q-card">
                                <label>עוצמת רגש (1-5)</label>
                                <input type="range" id="prism-emotion" min="1" max="5" value="3" /> <span id="emotion-display">3</span>
                            </div>
                            <div class="q-card">
                                <label>התנגדות (1-5)</label>
                                <input type="range" id="prism-resistance" min="1" max="5" value="2" /> <span id="resistance-display">2</span>
                            </div>

                            <div class="step-buttons">
                                <button id="prism-cancel" class="btn btn-secondary">← חזור לספריה</button>
                                <button id="prism-submit" class="btn btn-primary">מפה והמלץ Pivot →</button>
                            </div>
                        </div>

                        <div id="prism-result" class="final-blueprint-display hidden">
                            <!-- Result: pivot recommendation and map -->
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- CATEGORIES TAB -->
        <section id="categories" class="tab-content">
            <div id="categories-container"></div>
        </section>

        <!-- PRACTICE TAB -->
        <section id="practice" class="tab-content">
            <div class="practice-container">
                <div class="card">
                    <h2>תרגול דינאמי 🎮</h2>
                    <p class="subtitle">בחר קטגוריה וענ על שאלות אינטראקטיביות עם משוב מידי</p>
                    
                    <div class="practice-filters">
                        <label>בחר קטגוריה:</label>
                        <select id="category-select">
                            <option value="">הכל</option>
                        </select>
                    </div>

                    <div id="question-drill" class="card question-drill-card">
                        <div class="question-drill-header">
                            <h3>תרגיל בניית שאלות</h3>
                            <small>בחרו את המשפט, כתבו שאלה ותייגו את הכיוון (מחיקה/עיוות/הכללה).</small>
                        </div>
                        <p id="question-drill-statement" class="question-drill-statement"></p>
                        <textarea id="question-drill-input" rows="3" placeholder="כתוב/י כאן את השאלה שמחפשת את ההנחה הנסתרת..."></textarea>
                        <div class="question-drill-controls">
                            <label>
                                <span>ממוקד ב-</span>
                                <select id="question-drill-category">
                                    <option value="DELETION">Deletion</option>
                                    <option value="DISTORTION">Distortion</option>
                                    <option value="GENERALIZATION">Generalization</option>
                                </select>
                            </label>
                            <button id="question-drill-check" class="btn btn-primary">בדוק שאלה</button>
                            <button id="question-drill-next" class="btn btn-secondary">משפט חדש</button>
                        </div>
                        <div id="question-drill-feedback" class="question-drill-feedback"></div>
                        <div class="question-drill-stats">
                            <span>ניסיונות: <strong id="question-drill-attempts">0</strong></span>
                            <span>פגיעות: <strong id="question-drill-hits">0</strong></span>
                        </div>
                    </div>

                    <div id="rapid-pattern-arena" class="card rapid-pattern-card">
                        <div class="rapid-pattern-header">
                            <h3>⚡ Meta Radar: מונולוג + תבנית</h3>
                            <small>המילה/ביטוי המודגש הוא הטריגר. לחצו על אחת מ-15 התבניות לפני שנגמר הזמן.</small>
                        </div>

                        <div class="rapid-pattern-shell">
                            <aside class="rapid-pattern-side">
                                <div class="rapid-panel">
                                    <label for="rapid-case-type">סוג מטופל</label>
                                    <select id="rapid-case-type" class="rapid-control-select">
                                        <option value="random">רנדומלי</option>
                                    </select>
                                </div>

                                <div class="rapid-panel">
                                    <label for="rapid-time-limit">רמת קושי (זמן): <strong id="rapid-time-limit-value">12</strong> שנ׳</label>
                                    <input id="rapid-time-limit" type="range" min="6" max="25" value="12" />
                                </div>

                                <div class="rapid-panel">
                                    <label>רמזור טעויות</label>
                                    <div id="rapid-traffic-light" class="rapid-traffic-light" data-state="green" aria-label="רמזור מצב">
                                        <span class="rapid-light rapid-light-red" aria-hidden="true"></span>
                                        <span class="rapid-light rapid-light-yellow" aria-hidden="true"></span>
                                        <span class="rapid-light rapid-light-green" aria-hidden="true"></span>
                                    </div>
                                    <small id="rapid-errors-label">טעויות בשאלה: 0/2</small>
                                </div>

                                <div class="rapid-panel rapid-score-panel">
                                    <p>ניקוד: <strong id="rapid-score">0</strong></p>
                                    <p>רצף: <strong id="rapid-streak">0</strong></p>
                                    <p>שאלה: <strong id="rapid-round">0</strong></p>
                                </div>

                                <button id="rapid-start-btn" class="btn btn-primary">התחל סבב</button>
                            </aside>

                            <div class="rapid-pattern-main">
                                <div class="rapid-monologue-box">
                                    <p id="rapid-monologue-text" class="rapid-monologue-text">לחצו על "התחל סבב" כדי להתחיל זיהוי תבניות בזמן אמת.</p>
                                </div>

                                <div class="rapid-timer-row">
                                    <div class="rapid-timer-bar" aria-label="מד התקדמות זמן">
                                        <span id="rapid-timer-fill"></span>
                                    </div>
                                    <p id="rapid-feedback" class="rapid-feedback" data-tone="info">ממתין לתחילת סבב...</p>
                                </div>

                                <div id="rapid-pattern-buttons" class="rapid-pattern-buttons" role="group" aria-label="כפתורי תבניות"></div>
                            </div>
                        </div>
                    </div>

                    <div id="wrinkle-game" class="card wrinkle-game-card">
                        <div class="wrinkle-game-header">
                            <h3>🧩 חשף את הכמת!</h3>
                            <small>קודם חשיפה, אחר כך אתגור. בונים רפלקס מהיר לזיהוי הנחה סמויה.</small>
                            <div class="wrinkle-coverage">
                                <span>✓ כמתים סמויים</span>
                                <span>✓ Self-Reference אישי</span>
                            </div>
                        </div>

                        <div class="wrinkle-score-row">
                            <span>🔥 רצף: <strong id="wrinkle-streak">0</strong></span>
                            <span>⭐ נקודות: <strong id="wrinkle-points">0</strong></span>
                            <span>⏱️ Due: <strong id="wrinkle-due-count">0</strong></span>
                        </div>

                        <div class="wrinkle-round-box">
                            <p id="wrinkle-step-label" class="wrinkle-step-label">שלב 1/2: חשיפת הכמת</p>
                            <p id="wrinkle-statement" class="wrinkle-statement"></p>
                            <div id="wrinkle-options" class="wrinkle-options"></div>
                            <div id="wrinkle-feedback" class="wrinkle-feedback"></div>
                            <button id="wrinkle-next-btn" class="btn btn-primary hidden">משפט הבא</button>
                            <div id="wrinkle-fx-layer" class="wrinkle-fx-layer" aria-hidden="true"></div>
                        </div>

                        <div class="wrinkle-self-box">
                            <label for="wrinkle-self-input">בדיקת Self-Reference: כתבו משפט אישי לתרגול</label>
                            <textarea id="wrinkle-self-input" rows="2" placeholder="לדוגמה: אני לא יכול להוביל את השיחה הזאת."></textarea>
                            <div class="wrinkle-self-actions">
                                <button id="wrinkle-add-self-btn" class="btn btn-secondary">הוסף משפט אישי למשחק</button>
                            </div>
                            <ul id="wrinkle-self-list" class="wrinkle-self-list"></ul>
                        </div>
                    </div>

                    <!-- TRAINER MODE INTERFACE -->
                    <div id="trainer-mode" class="trainer-mode hidden">
                        <!-- QUESTION DISPLAY -->
                        <div id="question-display" class="question-display">
                            <div class="question-header">
                                <span class="question-counter">שאלה <span id="current-q">1</span> מתוך <span id="total-q">10</span></span>
                                <span id="question-xp-badge" class="xp-badge">+10 XP</span>
                            </div>
                            <div class="progress-bar">
                                <div id="progress-fill" class="progress-fill"></div>
                            </div>
                            <p class="question-text" id="question-text"></p>
                            <p id="progress-note" class="progress-note"></p>
                            <div id="trainer-reward-fx" class="trainer-reward-fx hidden" aria-live="polite"></div>
                        </div>

                        <!-- MCQ OPTIONS (Expandable) -->
                        <div class="mcq-options" id="mcq-options">
                            <!-- Options generated dynamically -->
                        </div>

                        <!-- FEEDBACK SECTION -->
                        <div id="feedback-section" class="feedback-section">
                            <div id="feedback-content" class="feedback-box"></div>
                            <button id="next-question-btn" class="btn btn-primary">השאלה הבאה →</button>
                        </div>

                        <!-- HINTS SECTION -->
                        <div id="trainer-hints" class="trainer-hints">
                            <div class="trainer-tools">
                                <button id="hint-trigger" class="btn btn-secondary hint-button">רמז</button>
                                <button id="why-trigger" class="btn btn-secondary hint-button">למה חשוב?</button>
                                <button id="depth-trigger" class="btn btn-secondary hint-button">עומק</button>
                                <button id="deletion-guide-trigger-live" class="btn btn-secondary hint-button hidden">מדריך מחיקה (6)</button>
                                <button id="skip-question-btn" class="btn btn-secondary hint-button">דלג</button>
                                <button id="audio-mute-btn" class="btn btn-secondary hint-button audio-mute-btn">סאונד פעיל</button>
                            </div>
                            <div id="hint-display" class="hint-display hidden"></div>
                            <div id="why-display" class="hint-display hidden"></div>
                            <div id="depth-display" class="hint-display hidden"></div>
                        </div>
                    </div>

                    <!-- START TRAINER BUTTON -->
                    <div id="trainer-start" class="start-section">
                        <p class="instruction">בחר קטגוריה ולחץ כדי להתחיל</p>
                        <div id="deletion-guide-entry" class="deletion-guide-entry hidden">
                            <button id="deletion-guide-trigger" class="btn btn-secondary">מדריך מלא: איך לפתור מחיקה (6 אפשרויות)</button>
                            <div id="deletion-guide-display" class="hint-display hidden"></div>
                        </div>
                        <button id="start-trainer-btn" class="btn btn-primary btn-large">🎮 התחל תרגול</button>
                    </div>

                    <!-- STATS -->
                    <div class="practice-stats">
                        <p>✅ תשובות נכונות: <span id="correct-count">0</span></p>
                        <p>📊 קצב הצלחה: <span id="success-rate">0%</span></p>
                        <p>⭐ הרוויח XP: <span id="session-xp">0</span></p>
                        <p>🌟 כוכבים בסשן: <span id="session-stars">0</span></p>
                    </div>
                </div>
            </div>
        </section>

        <!-- BLUEPRINT BUILDER TAB -->
        <section id="blueprint" class="tab-content">
            <div class="blueprint-container">
                <div class="card">
                    <h2>🏗️ Blueprint Builder - הפוך פעולה בעמומה לתוכנית ביצוע</h2>
                    <p>הקלד פעולה שצריך לעשות, ואנחנו נהפוך אותה לתוכנית מפורטת עם צעדים, תנאים, וחלופות.</p>

                    <!-- STEP 1: CAPTURE -->
                    <div id="blueprint-step-1" class="blueprint-step active">
                        <div class="step-header">
                            <span class="step-number">1</span>
                            <h3>מה אתה אומר לעצמך לעשות?</h3>
                        </div>
                        <p class="step-desc">הקלד את הפעולה בשפה טבעית - בדיוק כמו שהיית אומר לעצמך או שמישהו אמר לך.</p>
                        
                        <div class="input-group">
                            <textarea id="action-input" 
                                      placeholder="דוגמה: 'תתרגל את ה-JavaScript שלי' או 'תסגור את הפרויקט'"
                                      rows="4"></textarea>
                        </div>

                        <div class="step-buttons">
                            <button id="extract-btn" class="btn btn-primary" onclick="extractAndMoveToStep2()">חלץ ובנה Blueprint →</button>
                        </div>
                    </div>

                    <!-- STEP 2: EXTRACT & SPECIFY -->
                    <div id="blueprint-step-2" class="blueprint-step hidden">
                        <div class="step-header">
                            <span class="step-number">2</span>
                            <h3>פירוק הפעולה</h3>
                        </div>

                        <div class="blueprint-questions">
                            <div class="q-card">
                                <label>מה התוצאה בדיוק? (איך זה נראה בהצלחה?)</label>
                                <textarea id="q-success" placeholder="תופסתי את הקונספט של async/await"></textarea>
                            </div>

                            <div class="q-card">
                                <label>מה הצעד הראשון הקטן ביותר?</label>
                                <textarea id="q-first-step" placeholder="פתח טאב ב-VSCode ויצור קובץ test.js"></textarea>
                            </div>

                            <div class="q-card">
                                <label>מה הצעד האחרון - איך תדע שסיימת?</label>
                                <textarea id="q-last-step" placeholder="אוכל להשרות קוד async וקוד सinc בלי טעויות"></textarea>
                            </div>

                            <div class="q-card">
                                <label>איזה 3-5 שלבים באמצע?</label>
                                <textarea id="q-middle-steps" placeholder="1. קרא מאמר | 2. צפה בוידאו | 3. כתוב דוגמה | 4. בדוק בקונסול"></textarea>
                            </div>

                            <div class="q-card">
                                <label>מה צריך להיות נכון לפני התחלה? (מקום, ציוד, זמן, אישורים)</label>
                                <textarea id="q-prerequisites" placeholder="שעה חופשית, VSCode פתוח, חיבור אינטרנט"></textarea>
                            </div>

                            <div class="q-card">
                                <label>איפה אתה בדרך כלל נתקע?</label>
                                <textarea id="q-friction" placeholder="אני לא מבין מתי promises מסתיימות"></textarea>
                            </div>

                            <div class="q-card">
                                <label>מה Plan B כשנתקע? (חלופה, קיצור דרך, עזרה)</label>
                                <textarea id="q-alternatives" placeholder="אבקש עזרה ב-Stack Overflow או אחזור ל-callbacks"></textarea>
                            </div>

                            <div class="q-card">
                                <label>כמה זמן זה אמור לקחת? (מינימום 70% משימה)</label>
                                <input type="text" id="q-time" placeholder="45 דקות">
                            </div>
                        </div>

                        <div class="step-buttons">
                            <button id="back-to-capture-btn" class="btn btn-secondary" onclick="goToStep(1)">← חזור</button>
                            <button id="gap-analysis-btn" class="btn btn-primary" onclick="extractAndMoveToStep3()">בדיקת פער ציפיות →</button>
                        </div>
                    </div>

                    <!-- STEP 3: EXPECTATION GAP -->
                    <div id="blueprint-step-3" class="blueprint-step hidden">
                        <div class="step-header">
                            <span class="step-number">3</span>
                            <h3>פער ציפיות vs יכולת</h3>
                        </div>
                        <p class="step-desc">בואן נבחן את הפער בין מה שמצפים ממך לבין מה אתה יכול לעשות כרגע.</p>

                        <div class="blueprint-questions">
                            <div class="q-card">
                                <label>מי מצפה? (אתה / מישהו אחר / מערכת)</label>
                                <select id="q-who-expects">
                                    <option value="">בחר...</option>
                                    <option value="self">אני בעצמי</option>
                                    <option value="other">מישהו אחר</option>
                                    <option value="system">מערכת/חוק/דדליין</option>
                                </select>
                            </div>

                            <div class="q-card">
                                <label>מה בדיוק הציפייה?</label>
                                <textarea id="q-expectation" placeholder="אני אמור להתפקד כ-JavaScript expert"></textarea>
                            </div>

                            <div class="q-card">
                                <label>איזו הנחה סמויה כאן? (על מה הציפיה מניחה?)</label>
                                <textarea id="q-assumption" placeholder="'זה וודאי קל', 'כולם יודעים את זה', 'צריך 5 דקות'"></textarea>
                            </div>

                            <div class="q-card">
                                <label>יכולת כרגע (0-10, כש-10 זה מושלם)</label>
                                <input type="range" id="q-ability" min="0" max="10" value="5">
                                <span id="ability-display">5</span>
                            </div>

                            <div class="q-card">
                                <label>מה חסר לך כדי לעלות נקודה אחת?</label>
                                <textarea id="q-gap" placeholder="15 דקות דוקומנטציה / כלי ניתונים / אישור / קונה דעת"></textarea>
                            </div>

                            <div class="q-card gap-reframe">
                                <label>🎯 ניסוח מחדש (לא-מאשים):</label>
                                <div id="q-reframe" class="reframe-box">
                                    (ה-הודעה תתעדכן אוטומטית)
                                </div>
                            </div>
                        </div>

                        <div class="step-buttons">
                            <button id="back-to-specify-btn" class="btn btn-secondary" onclick="goToStep(2)">← חזור</button>
                            <button id="next-step-btn" class="btn btn-primary" onclick="extractAndMoveToStep4()">צעד הבא ותוכנית →</button>
                        </div>
                    </div>

                    <!-- STEP 4: FINAL PLAN -->
                    <div id="blueprint-step-4" class="blueprint-step hidden">
                        <div class="step-header">
                            <span class="step-number">4</span>
                            <h3>תוכנית הביצוע סופית ✨</h3>
                        </div>

                        <div id="final-blueprint" class="final-blueprint-display">
                            <!-- Blueprint output will go here -->
                        </div>

                        <div id="next-action-box" class="next-action">
                            <h4>🎯 הצעד שלך הבא:</h4>
                            <p id="next-physical-action"></p>
                        </div>

                        <div id="if-stuck-box" class="if-stuck">
                            <h4>אם נתקעת:</h4>
                            <p id="if-stuck-content"></p>
                        </div>

                        <div class="action-buttons">
                            <button id="export-json-btn" class="btn btn-secondary" onclick="exportBlueprint()">📥 ייצא JSON</button>
                            <button id="start-over-btn" class="btn btn-secondary" onclick="goToStep(1)">🔄 Blueprint חדש</button>
                            <button id="do-it-now-btn" class="btn btn-primary" onclick="startTenMinuteTimer()">⏱️ בואן נעשה את זה ב-10 דקות!</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ABOUT TAB -->
        <section id="about" class="tab-content">
            <div class="card">
                <h2>על הפרויקט 📖</h2>
                <p><strong>Meta Model - כלי תרגול מטה מודל</strong></p>
                <p>פרויקט זה מעוצב כדי לעזור ללומדים של NLP (Neuro-Linguistic Programming) ליישום טכניקות Meta Model של Richard Bandler ו-John Grinder.</p>
                
                <h3>הקטגוריות העיקריות:</h3>
                <ul>
                    <li><strong>DELETION (מחיקה)</strong> - מחיקת מידע חשוב</li>
                    <li><strong>DISTORTION (עיוות)</strong> - שינוי המציאות</li>
                    <li><strong>GENERALIZATION (הכללה)</strong> - הרחבה מעבר לצריך</li>
                </ul>

                <h3>המקורות:</h3>
                <ul>
                    <li>Richard Bandler & John Grinder - Founders of NLP</li>
                    <li><a href="https://github.com/streamDragon/Meta_Model_app" target="_blank">GitHub Repository</a></li>
                </ul>

                <p class="footer-text">פיתוח על ידי: streamDragon | 2026</p>
            </div>
        </section>
    </div>

    <script src="js/app.js?v=1.0.3"></script>
</body>
</html>
